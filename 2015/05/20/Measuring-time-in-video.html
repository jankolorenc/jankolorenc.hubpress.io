<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Measuring time in video</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="//jankolorenc.github.io/themes/Roon/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:400,700,400italic,700italic|Open+Sans:400italic,700italic,700,400">
    <link rel="stylesheet" type="text/css" href="//jankolorenc.github.io/themes/Roon/assets/css/screen.css?v=1.0.0" />

    <link rel="canonical" href="https://jankolorenc.github.io/2015/05/20/Measuring-time-in-video.html" />
    
    <meta property="og:site_name" content="Jan Kolorenc blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Measuring time in video" />
    <meta property="og:description" content="Measuring time from video is easy with suitable application, but special care has to be taken to how the video is recorded. Improper recording can make video useless. This article explain problems with recording video on ordinary PC and describe..." />
    <meta property="og:url" content="https://jankolorenc.github.io/2015/05/20/Measuring-time-in-video.html" />
    <meta property="article:published_time" content="2015-05-19T22:00:00.000Z" />
    <meta property="article:modified_time" content="2019-10-18T08:18:24.999Z" />
    <meta property="article:tag" content="Video" />
    <meta property="article:tag" content="Time" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Measuring time in video" />
    <meta name="twitter:description" content="Measuring time from video is easy with suitable application, but special care has to be taken to how the video is recorded. Improper recording can make video useless. This article explain problems with recording video on ordinary PC and describe..." />
    <meta name="twitter:url" content="https://jankolorenc.github.io/2015/05/20/Measuring-time-in-video.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Jan Kolorenc blog",
    "author": {
        "@type": "Person",
        "name": null,
        "image": "https://avatars1.githubusercontent.com/u/9655896?v=4",
        "url": "undefined/author/undefined",
        "sameAs": ""
    },
    "headline": "Measuring time in video",
    "url": "https://jankolorenc.github.io/2015/05/20/Measuring-time-in-video.html",
    "datePublished": "2015-05-19T22:00:00.000Z",
    "dateModified": "2019-10-18T08:18:24.999Z",
    "keywords": "Video,  Time",
    "description": "Measuring time from video is easy with suitable application, but special care has to be taken to how the video is recorded. Improper recording can make video useless. This article explain problems with recording video on ordinary PC and describe..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Jan Kolorenc blog" href="https://jankolorenc.github.io/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
</head>
<body class="post-template tag-Video tag-Time  noimage">

    


    <article role="main" class="">
        <header>
            <a href="https://jankolorenc.github.io" id="home_link">Â«</a>
            <div class="meta"><time datetime="2015-05-20"><a href="/2015/05/20/Measuring-time-in-video.html">May 20, 2015</a></time> <span class="count" id="js-reading-time"></span></div>
            <h1>Measuring time in video</h1>
        </header>

        <div class="text" id="js-post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Measuring time from video is easy with suitable application, but special care has to be taken to how the video is recorded. Improper recording can make video useless.
This article explain problems with recording video on ordinary PC and describe application for measuring time in video. The application is ready to <a href="https://github.com/jankolorenc/VideoTimeMeasure/releases">download</a> and try.</p>
</div>
<div class="paragraph">
<p>Updated <a href="https://github.com/jankolorenc/VideoTimeMeasure/blob/master/exported_scripts/Trampoline%20synchronous%202017%20example.zip">synchronized trampoline script</a> according to rules since 2017</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_air_time">Air time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In trampoline jumping, air time is a part of final score.
Jump air time is normally measured by photo diode positioned under bounce mat. Jumper crosses the infra red beam after landing till next bounce. Air time is sum of intervals when the beam is not crossed. Judge has to start measuring device just before the first move.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/trampoline_jumping.gif" alt="Measuring air time">
</div>
<div class="title">Figure 1. Measuring air time</div>
</div>
<div class="paragraph">
<p>Sometimes measuring device didn&#8217;t work or air time judge didn&#8217;t start the device in the right time. Jumping routines had been recorded for possible later protests. When the air time measuring device didn&#8217;t give result, the air time had to be measured from the recorded video.</p>
</div>
<div class="paragraph">
<p>Video was recorded using USB web camera and encoded on PC. We found that time measured from video was significantly shorter than time measured by air time measuring device. The problem was in PC used as video encoder.</p>
</div>
<div class="paragraph">
<p>To clarify the problem, next chapter describe important video recording aspects.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_video_recording">Video recording</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Video is recorded by taking pictures in regular interval. Number of pictures taken in second is called frames per second (FPS). The FPS information is stored together with captured pictures and video player uses FPS information to determine time when to show next picture. When video recorder doesn&#8217;t keep declared FPS, time in video is damaged and there is no way to identify and correct the problem from video itself.</p>
</div>
<div id="img-damaged_fps" class="imageblock">
<div class="content">
<img src="/images/damaged_fps.png" alt="Damaged time in video">
</div>
<div class="title">Figure 2. Damaged time in video</div>
</div>
<div class="paragraph">
<p>Figure <a href="#img-damaged_fps">Damaged time in video</a> show video time damages caused by inaccurate FPS on recorder side. First column is ideal case when recorder keeps declared FPS and player show pictures in the right time. In the second column, video recorder take pictures later than declared. This causes shorter video duration in player. In the third column recorder takes pictures faster than declared FPS and video in player seems to be longer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_video_recording_on_pc">Video recording on PC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As demonstrated in previous chapter, it is necessary to keep FPS as precise as possible. Today&#8217;s PC include powerful processors that can encode video clip in shorter time than the clip lasts. PCs run multitasking operating systems like MS Windows. There are several tasks running on PC in the same time like video encoding, anti virus check, windows update, &#8230;&#8203; Try to run task manager to see running processes when PC "does nothing". All running tasks share single processor or few processor cores. Operating system pretends that all tasks are running simultaneously by switching between them in short intervals. Running task receive processor for a while and then the processor is provided to another task. Ordinary multitasking operating systems don&#8217;t guarantee time when the task receives processor again.</p>
</div>
<div class="paragraph">
<p>So it is hard to keep FPS on ordinary multitasking operating system and encode live video even for powerful processors. This was our problem. Video recorder didn&#8217;t keep FPS and the video time was skewed. There are real time operating systems that guarantee maximal time interval when the task receives processor again, but they are not commonly installed on PCs.</p>
</div>
<div class="paragraph">
<p>Camcorders can record and encode live video without problem, because they do the recording only using specialized hardware.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_taking_time_from_video">Taking time from video</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is an application that can display time for each picture (frame) in video clip and allow easily measure time. The problem was the application required AVI container. Camcorders don&#8217;t produce required AVI container. Video from camcorders was transcoded to AVI container required by the measuring application, but the transcoders reduced FPS so time measuring was less precise. Transcoding significantly slowed work.</p>
</div>
<div class="paragraph">
<p>I decided to create similar time measuring application that can handle video clips directly from camcorders.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_requirements">Application requirements</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>GUI application to measure several time intervals in video clip.</p>
</li>
<li>
<p>User marks begin and end pictures of intervals. Application shows total time as sum of measured intervals.</p>
</li>
<li>
<p>Save interval borders for later inspection.</p>
</li>
<li>
<p>Handle as much as possible video formats generated by camcorders.</p>
</li>
<li>
<p>Allow to move in video picture by picture forward and backward.</p>
</li>
<li>
<p>Use available libraries to reduce development time.</p>
</li>
<li>
<p>GUI design inspired by existing application.</p>
</li>
<li>
<p>Multiplatform at least for Windows and Linux (nice to have).</p>
</li>
<li>
<p>Use case:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Record video clips on camcorders recording to SD cards. The more FPS the more precise measurement.</p>
</li>
<li>
<p>In case of air time measuring problem, remove SD card from camcorder and insert another.</p>
</li>
<li>
<p>Measure time from video on removed SD card.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Following text goes deeper into application architecture and it is hidden to end user.</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_selected_libraries_and_programming_language">Selected libraries and programming language</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>FFMpeg - nice video library that can natively handle large amount of video format. Allows to move forward and backward in video.</p>
</li>
<li>
<p>QT library - nice multiplatform GUI library with designer.</p>
</li>
<li>
<p>C/C++ to glue FFMpeg with QT.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are wrappers over FFMpeg and QT for higher level languages, but rather incomplete, so backward moving picture by picture is difficult.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_decoding_pictures_using_ffmpeg_library">Decoding pictures using FFMpeg library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Video periodically contain complete pictures called I-frames. Other pictures between I-frames are stored as ``difference'' to previous I-frame (P-frames) and next I-frame (B-frames). When decoding required frame, jump to nearest previous I-frame and decode sequentially until required picture is reached. Going sequentially backwards is not natively possible.</p>
</div>
<div class="paragraph">
<p>Jumping is in time units that makes harder to estimate jump length. Number of I-frames per time unit (GOP) is not always available. Several tries to reach nearest I-frame is sometimes necessary. FFMpeg assign presentation timestamp to each picture and automatically decodes all pictures necessary to show required picture when going forward. Pictures are not always stored in the same order as they are captured.</p>
</div>
<div class="paragraph">
<p>Decoded pictures are saved into buffer to reduce jumping when going several pictures backward. The buffer takes some RAM.</p>
</div>
<div class="paragraph">
<p>Thanks for nice <a href="https://github.com/chelyaev/ffmpeg-tutorial">FFMpeg tutorial</a>.</p>
</div>
</div>
</div>
        </div>

        <menu>
            <a href="" id="btn_share" class="btn" title="Share">
                <span aria-hidden="true" data-icon="S"></span>
                <strong>Share</strong>
            </a>
            <a href="http://twitter.com/share?text=Measuring%20time%20in%20video&url=https://jankolorenc.github.io/2015/05/20/Measuring-time-in-video.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" id="btn_comment" class="btn" target="_blank">
                <span aria-hidden="true" data-icon="C"></span> Comment on Twitter
            </a>
        </menu>


        <footer class="post-footer" role="contentinfo">

            <div class="vcard">
                <!-- <a href="https://jankolorenc.github.io/rss" id="btn_feed" class="btn" title="Feed" target="_blank">
                    <span aria-hidden="true" data-icon=")"></span>
                    <strong>Feed</strong>
                </a> -->

                <a href="" class="photo">
                    <span style="background-image: url('https://avatars1.githubusercontent.com/u/9655896?v=4');">
                        <img src="https://avatars1.githubusercontent.com/u/9655896?v=4" alt="">
                    </span>
                </a>

                <div class="details">
                    <h4><a href="" class="url n"></a></h4>
                    
                    
                </div>
            </div>

            <div id="user_bio">
                <div class="inner">
                    
                </div>
            </div>

        </footer>




    <section class="post-comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
      var disqus_shortname = 'jankolorencblog'; // required: replace example with your forum shortname
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </section>


    </article>

    <div id="share_modal">
        <div class="wrap">
            <div class="inner">
                <header>
                    Share
                    <a href="" class="close" title="Close">&times;</a>
                </header>

                <div class="roon-share-links">
                    <a href="https://twitter.com/share" class="twitter-share-button" data-dnt="true">Tweet</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                    <div id="fb-elems">
                        <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                        var js, fjs = d.getElementsByTagName(s)[0];
                        if (d.getElementById(id)) return;
                        js = d.createElement(s); js.id = id;
                        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=463438580397968";
                        fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));</script>
                        <div class="fb-like" data-send="false" data-layout="button_count" data-width="110" data-show-faces="false" data-font="arial"></div>
                    </div>

                    <div id="pinit-btn">
                        <a href="//pinterest.com/pin/create/button/?url=https://jankolorenc.github.io/2015/05/20/Measuring-time-in-video.html&amp;description=Measuring%20time%20in%20video-Jan%20Kolorenc%20blog " data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pin_it_button.png"></a>
                        <script type="text/javascript" src="//assets.pinterest.com/js/pinit.js"></script>
                    </div>
                </div>
            </div>
        </div>
    </div>






    <script>

            function get_text(el) {
                ret = "";
                var length = el.childNodes.length;
                for(var i = 0; i < length; i++) {
                    var node = el.childNodes[i];
                    if(node.nodeType != 8) {
                        ret += node.nodeType != 1 ? node.nodeValue : get_text(node);
                    }
                }
                return ret;
            }
            function reading_time () {
                var post_content = document.getElementById('js-post-content');
                if (post_content) {
                    var words = get_text(post_content),
                        count = words.split(/\s+/).length,
                        read_time = Math.ceil((count / 150)),
                        read_time_node = document.createTextNode(read_time + ' min read');
                    document.getElementById('js-reading-time').appendChild(read_time_node);
                }
            }

        function no_schema_links () {
            var links = document.querySelectorAll('.js-remove-domain-schema');
            if (links) {
                for (i = 0; i < links.length; ++i) {
                    var link = links[i],
                        text = link.innerHTML,
                        no_schema = text.replace(/.*?:\/\//g, "");
                    link.innerHTML = no_schema;
                }
            }
        }

        window.onload = function () {
            no_schema_links();

            reading_time();
        }
    </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>

        <script>
            $(function(){
                var share_modal = $("#share_modal"),
                    update_social_links = true;

                $("#btn_share").click(function(){
                    var that = $(this);
                    share_modal.fadeIn(200);
                    return false;
                });

                share_modal.click(function(e){
                    if (e.target.className == "wrap" || e.target.id == "share_modal") {
                        share_modal.fadeOut(200);
                    }
                    return false;
                });

                share_modal.find("div.inner > header > a.close").click(function(){
                    share_modal.fadeOut(200);
                    return false;
                });
            });
        </script>

</body>
</html>
